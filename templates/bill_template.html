<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Invoice - {{ order.id[:8] }}</title>
    
    <style>
        /* Base styles for WeasyPrint compatibility */
        body { 
            font-family: Arial, sans-serif; 
            font-size: 10pt; 
            margin: 0; 
            padding: 0; 
        }
        .container { width: 95%; margin: 0 auto; }
        .header-table, .details-table, .items-table, .summary-table, .bank-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 10px;
        }
        .header-table th, .header-table td, .items-table th, .items-table td {
            padding: 6px 8px;
            border: 1px solid #ccc;
            vertical-align: top;
        }
        
        /* Specific Styles */
        .invoice-title { font-size: 16pt; font-weight: bold; text-align: center; margin: 10px 0; }
        .company-name { font-size: 14pt; font-weight: bold; margin-bottom: 5px; color: #333; }
        .label { font-weight: bold; font-size: 8pt; color: #555; }
        .value { font-size: 9pt; }
        .items-table th { background-color: #eee; font-size: 8.5pt; text-transform: uppercase; text-align: center; }
        .items-table td { font-size: 8.5pt; }
        .total-box { background-color: #f0f0f0; font-weight: bold; padding: 5px; }
        .total-in-words { font-style: italic; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    
    <table class="header-table" style="border: none;">
        <tr>
            <td style="width: 50%; text-align: left; border: none; padding-left: 0;">
                <p style="font-size: 16pt; font-weight: bold; margin: 0; color: #1e40af;">{{ bill_settings.companyName | default('RK Construction') | upper }}</p>
                <p style="font-size: 10pt; margin: 0;">{{ bill_settings.companyAddress or 'N/A' }}</p>
            </td>
            <td style="width: 50%; text-align: right; border: none; padding-right: 0;">
                <p class="invoice-title" style="margin-bottom: 0;">e-Invoice</p>
                <p style="font-size: 10pt; margin: 0;">Date: {{ order.date | datetimeformat }}</p>
                <p style="font-size: 10pt; margin: 0;">Invoice No: NE-{{ order.id[:8] | upper }}</p>
            </td>
        </tr>
    </table>
    
    <hr style="border: 0.5px solid #ccc;">

    {# CUSTOMER/PARTY DETAILS #}
    <table class="details-table" style="margin-top: 15px;">
        <tr style="background-color: #f5f5f5;">
            <td colspan="2" style="font-weight: bold; font-size: 10pt;">Party (Bill To)</td>
        </tr>
        <tr>
            <td style="width: 50%;">
                <p class="label">Name</p>
                <p class="value">{{ order.customer_name }}</p>
            </td>
            <td style="width: 50%;">
                <p class="label">Order ID</p>
                <p class="value">{{ order.id }}</p>
            </td>
        </tr>
        <tr>
            <td>
                <p class="label">Contact</p>
                <p class="value">N/A</p>
            </td>
            <td>
                <p class="label">State / Region</p>
                <p class="value">Madhya Pradesh (Mock)</p>
            </td>
        </tr>
    </table>

    {# ORDER ITEMS TABLE #}
    <div class="invoice-title" style="margin-top: 20px;">TAX INVOICE</div>
    <table class="items-table" style="margin-top: 5px;">
        <thead>
            <tr>
                <th style="width: 5%;">SI. No.</th>
                <th style="width: 35%;">Description of Goods</th>
                <th style="width: 10%;">Qty</th>
                <th style="width: 10%;">Rate (Tax Incl.)</th>
                <th style="width: 10%;">Disc. (₹)</th>
                <th style="width: 25%;">Amount (Total Tax Incl.)</th>
            </tr>
        </thead>
        <tbody>
            {% for item in order.line_items %}
            <tr>
                <td style="text-align: center;">{{ loop.index }}</td>
                <td>{{ item.name }}</td>
                <td style="text-align: center;">{{ item.quantity }}</td>
                <td style="text-align: right;">{{ item.price_at_purchase | format_float }}</td>
                <td style="text-align: right;">{{ item.discountAmount | format_float }}</td>
                <td style="text-align: right;">{{ item.line_net_total | format_float }}</td>
            </tr>
            {% endfor %}
            {# Empty cells for aesthetic padding #}
            {% for i in range(1, 4 - order.line_items|length) %}
            <tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td></tr>
            {% endfor %}
        </tbody>
    </table>

    {# SUB TOTAL AND TAX BREAKDOWN #}
    <table class="summary-table" style="border: none;">
        <tbody>
            {# Taxable Value #}
            <tr>
                <td style="width: 65%; border: none;"></td>
                <td style="width: 20%; font-weight: bold; text-align: right; border: 1px solid #ccc; padding-right: 10px;">Taxable Value</td>
                <td style="width: 15%; text-align: right; border: 1px solid #ccc; font-weight: bold;">₹{{ totals.taxable_value | format_float }}</td>
            </tr>
            {# CGST #}
            <tr>
                <td style="width: 65%; border: none;"></td>
                <td style="width: 20%; text-align: right; border: 1px solid #ccc; padding-right: 10px;">CGST @ {{ (bill_settings.tax_rate_cgst * 100) | format_float }}%</td>
                <td style="width: 15%; text-align: right; border: 1px solid #ccc;">₹{{ totals.cgst_amount | format_float }}</td>
            </tr>
            {# SGST #}
            <tr>
                <td style="width: 65%; border: none;"></td>
                <td style="width: 20%; text-align: right; border: 1px solid #ccc; padding-right: 10px;">SGST/UTGST @ {{ (bill_settings.tax_rate_sgst * 100) | format_float }}%</td>
                <td style="width: 15%; text-align: right; border: 1px solid #ccc;">₹{{ totals.sgst_amount | format_float }}</td>
            </tr>
            {# GRAND TOTAL #}
            <tr class="total-box">
                <td colspan="2" style="font-size: 11pt; text-align: right; background-color: #ddd; border: 1px solid #ccc; padding-right: 10px;">Total Amount</td>
                <td style="font-size: 11pt; text-align: right; background-color: #ddd; border: 1px solid #ccc;">₹{{ totals.grand_total | format_float }}</td>
            </tr>
        </tbody>
    </table>

    {# AMOUNT IN WORDS #}
    <p class="total-in-words" style="font-size: 11pt;">Amount Chargeable (in words): <span style="text-transform: capitalize;">{{ totals.grand_total | format_float }} Only.</span></p>

    {# BANK DETAILS #}
    <table class="bank-table" style="margin-top: 30px;">
        <tr style="background-color: #f5f5f5;">
            <td colspan="2" style="font-weight: bold; font-size: 10pt;">Company's Bank Details</td>
        </tr>
        <tr>
            <td style="width: 50%;">
                <p class="label">Bank Name</p>
                <p class="value">{{ bill_settings.bank_name or 'Default Bank' }}</p>
            </td>
            <td style="width: 50%;">
                <p class="label">A/C No.</p>
                <p class="value">{{ bill_settings.account_number or '000000' }}</p>
            </td>
        </tr>
    </table>

    {# DECLARATION AND SIGNATURE #}
    <div style="margin-top: 40px; font-size: 9pt;">
        <p class="label">Declaration</p>
        <p>{{ bill_settings.footerText or 'Thank you for your business! All sales are final.' }}</p>
    </div>
    
    <div style="margin-top: 50px; text-align: right;">
        <p style="font-weight: bold; border-top: 1px solid #000; display: inline-block; padding-top: 5px;">Authorized Signatory</p>
    </div>

</div>
</body>
</html>